<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin</title>
    <style>
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      .header h2 {
        font-size: 2.5em;
        color: #473e3e;
      }
      .btn-right {
        display: flex;
        gap: 20px;
        align-items: center;
      }
      .btn-right button {
        padding: 9px 18px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 20px;
      }
      .mode {
        background: #605858;
        color: white;
      }
      .logout {
        background: rgb(249, 137, 137);
        color: white;
      }
      .hello {
        margin: 10px;
        font-size: 30px;
      }
      .a:hover {
        opacity: 0.7;
        transition: 0.4s;
      }
      .ss {
        color: green;
        margin: 0 10px;
        font-size: 24px;
      }
      .failed {
        color: red;
        margin: 0 10px;
        font-size: 24px;
      }
      .container {
        display: flex;
        gap: 30px;
        margin-top: 50px;
      }
      .card {
        background: #fff;
        border-radius: 18px;
        padding: 25px;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
      }
      .left {
        width: 35%;
      }

      .right {
        width: 65%;
      }
      .card h3 {
        margin-bottom: 15px;
        font-size: 1.5em;
      }
      label {
        display: block;
        margin: 10px 0px;
        font-size: 20px;
      }
      input,
      select {
        width: 100%;
        height: 38px;
        padding: 7px 10px;
        margin-bottom: 15px;
        border: 1px solid #dcdcdc;
        border-radius: 10px;
        font-size: 1em;
      }
      .create {
        min-width: 100%;
        padding: 10px 0px;
        border-radius: 25px;
        border: none;
        background-color: rgb(172, 172, 247);
        font-size: 20px;
        color: white;
        cursor: pointer;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 20px;
      }

      th {
        text-align: left;
        padding: 10px 0;
        color: #666;
      }

      td {
        padding: 12px 0;
        border-bottom: 1px solid #eee;
      }
      .top-right {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .search {
        width: 50%;
        height: 36px;
        border-radius: 10px;
        border: 1px solid #dcdcdc;
        padding: 5px 12px;
      }
      .active {
        color: blue;
        font-size: 18px;
      }
      .delete {
        background-color: rgb(240, 96, 96);
        font-size: 18px;
        min-width: 100px;
        border: none;
        padding: 5px 10px;
        border-radius: 8px;
        cursor: pointer;
      }
    </style>
    <link rel="stylesheet" href="/assets/css/layout.css" />
  </head>
  <body>
    <header class="main-header">
      <div class="logo">
        <a href="noidung.html">Website qu·∫£n l√Ω b√†i vi·∫øt</a>
      </div>

      <button class="theme-toggle" aria-label="Toggle light and dark mode">
        ‚òÄÔ∏è
      </button>

      <button class="menu-toggle" aria-label="Toggle navigation">
        &#9776;
      </button>

      <nav class="main-nav">
        <ul class="nav-list">
          <li><a href="noidung.html" class="nav-item">üè† Trang ch·ªß</a></li>
          <li>
            <a href="thongkeuser.html" class="nav-item user-stat-btn"
              >üìä Th·ªëng k√™ c√° nh√¢n</a
            >
          </li>

          <li class="admin-only" style="display: none">
            <a href="quanly.html" class="nav-item">‚öôÔ∏è Qu·∫£n l√Ω Admin</a>
          </li>
          <li class="admin-only" style="display: none">
            <a href="thongkeadmin.html" class="nav-item">üìà Th·ªëng k√™ chung</a>
          </li>

          <li>
            <a href="#" class="nav-item auth-btn logout-link">üö™ ƒêƒÉng xu·∫•t</a>
          </li>
          <li>
            <a
              href="login.html"
              class="nav-item auth-btn login-link logout"
              style="display: none"
              >üîë ƒêƒÉng nh·∫≠p</a
            >
          </li>
        </ul>
      </nav>
    </header>
    <p class="hello">Xin ch√†o, admin!</p>
    <div class="container">
      <div class="card left">
        <form>
          <h3>Th√™m t√†i kho·∫£n m·ªõi</h3>
          <label>T√™n ƒëƒÉng nh·∫≠p</label>
          <input type="text" placeholder="T√™n ƒëƒÉng nh·∫≠p" autocomplete="off" />
          <label>M·∫≠t kh·∫©u</label>
          <input
            type="password"
            placeholder="M·∫≠t kh·∫©u"
            autocomplete="new-password"
          />
          <label>Vai tr√≤</label>
          <select>
            <option>Admin</option>
            <option>User</option>
          </select>
          <button class="create a">T·∫°o t√†i kho·∫£n</button>
        </form>
        <p class="ss">T·∫°o t√†i kho·∫£n th√†nh c√¥ng</p>
        <p class="failed">Username ho·∫∑c password kh√¥ng h·ª£p l·ªá</p>
      </div>
      <div class="card right">
        <div class="top-right">
          <h3>Danh s√°ch t√†i kho·∫£n</h3>
          <input type="text" placeholder="T√¨m t√†i kho·∫£n...." class="search" />
        </div>
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Vai tr√≤</th>
              <th>Ng√†y t·∫°o</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>admin</td>
              <td>Admin</td>
              <td>2025-01-02</td>
              <td class="active">ƒêang ho·∫°t ƒë·ªông</td>
            </tr>
            <tr>
              <td>user1</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">X√≥a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">X√≥a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">X√≥a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">X√≥a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">X√≥a</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
  <script src="layout.js"></script>
  <script>
    const loggedInUser = localStorage.getItem("loggedInUser");
    const userRole = localStorage.getItem("loggedInUserRole");

    const helloElement = document.querySelector(".hello");
    const btnLogout = document.querySelector(".logout");
    const createButton = document.querySelector(".create");
    const form = document.querySelector(".card.left form");
    const usernameInput = form.querySelector("input:nth-of-type(1)");
    const passwordInput = form.querySelector("input:nth-of-type(2)");
    const roleSelect = form.querySelector("select");
    const successMessage = document.querySelector(".ss");
    const failedMessage = document.querySelector(".failed");
    const tbody = document.querySelector("table tbody");
    const searchInput = document.querySelector(".search");
    const btnStats = document.querySelector(".stats");

    // ·∫®n th√¥ng b√°o m·∫∑c ƒë·ªãnh
    successMessage.style.display = "none";
    failedMessage.style.display = "none";

    // H√†m l·∫•y danh s√°ch t√†i kho·∫£n
    const getAccounts = () => {
      return JSON.parse(localStorage.getItem("accounts")) || [];
    };

    // 1. KI·ªÇM TRA QUY·ªÄN V√Ä HI·ªÇN TH·ªä TH√îNG TIN USER

    // Ch·ªâ cho ph√©p admin truy c·∫≠p trang n√†y
    if (userRole !== "admin" || !loggedInUser) {
      alert("B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang qu·∫£n l√Ω n√†y.");
      window.location.href = "noidung.html";
    } else {
      helloElement.textContent = `Xin ch√†o, ${loggedInUser} (${userRole})!`;
    }

    // 2. TH√äM T√ÄI KHO·∫¢N M·ªöI

    createButton.addEventListener("click", (e) => {
      e.preventDefault();
      successMessage.style.display = "none";
      failedMessage.style.display = "none";

      const user = usernameInput.value.trim();
      const pass = passwordInput.value.trim();
      const role = roleSelect.value.toLowerCase();

      if (user.length < 3 || pass.length < 6) {
        failedMessage.textContent =
          "T√™n ƒëƒÉng nh·∫≠p (√≠t nh·∫•t 3 k√Ω t·ª±) ho·∫∑c M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±) kh√¥ng h·ª£p l·ªá.";
        failedMessage.style.display = "block";
        return;
      }

      let accounts = getAccounts();
      const existingAccount = accounts.find((acc) => acc.username === user);

      if (existingAccount) {
        failedMessage.textContent =
          "T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i, vui l√≤ng ch·ªçn t√™n kh√°c.";
        failedMessage.style.display = "block";
        return;
      }

      // Th√™m t√†i kho·∫£n m·ªõi
      const newAccount = {
        username: user,
        password: pass,
        role: role,
        dateCreated: new Date().toISOString().split("T")[0],
      };

      accounts.push(newAccount);
      localStorage.setItem("accounts", JSON.stringify(accounts));

      successMessage.textContent = `T·∫°o t√†i kho·∫£n ${user} (${role}) th√†nh c√¥ng!`;
      successMessage.style.display = "block";

      usernameInput.value = "";
      passwordInput.value = "";
      displayAccounts(accounts);
    });

    // 3. HI·ªÇN TH·ªä DANH S√ÅCH T√ÄI KHO·∫¢N

    function displayAccounts(accountsToShow) {
      tbody.innerHTML = "";

      if (accountsToShow.length === 0) {
        tbody.innerHTML =
          '<tr><td colspan="4">Kh√¥ng t√¨m th·∫•y t√†i kho·∫£n n√†o.</td></tr>';
        return;
      }

      accountsToShow.forEach((account) => {
        const isCurrentUser = account.username === loggedInUser;

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${account.username}</td>
            <td>${account.role}</td>
            <td>${account.dateCreated || "N/A"}</td>
            <td>
                ${
                  isCurrentUser
                    ? `<span class="active">ƒêang ho·∫°t ƒë·ªông</span>`
                    : `<button class="delete a" data-username="${account.username}">X√≥a</button>`
                }
            </td>
        `;
        tbody.appendChild(row);
      });

      tbody.querySelectorAll(".delete").forEach((button) => {
        button.addEventListener("click", (e) => {
          const userToDelete = e.target.dataset.username;
          handleDeleteAccount(userToDelete);
        });
      });
    }

    // 4. X·ª¨ L√ù T√åM KI·∫æM

    searchInput.addEventListener("input", () => {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const accounts = getAccounts();

      const filteredAccounts = accounts.filter((account) => {
        return (
          account.username.toLowerCase().includes(searchTerm) ||
          account.role.toLowerCase().includes(searchTerm)
        );
      });

      displayAccounts(filteredAccounts);
    });

    // 5. X·ª¨ L√ù X√ìA T√ÄI KHO·∫¢N

    function handleDeleteAccount(username) {
      if (username === loggedInUser) {
        alert("B·∫°n kh√¥ng th·ªÉ t·ª± x√≥a t√†i kho·∫£n c·ªßa m√¨nh!");
        return;
      }

      if (
        !confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n "${username}" kh√¥ng?`)
      ) {
        return;
      }

      let accounts = getAccounts();
      const updatedAccounts = accounts.filter(
        (acc) => acc.username !== username
      );

      localStorage.setItem("accounts", JSON.stringify(updatedAccounts));
      alert(`T√†i kho·∫£n ${username} ƒë√£ ƒë∆∞·ª£c x√≥a.`);

      displayAccounts(updatedAccounts);
    }

    // CH·∫†Y CH·ª®C NƒÇNG KHI T·∫¢I TRANG L·∫¶N ƒê·∫¶U
    const initialAccounts = getAccounts();
    displayAccounts(initialAccounts);
  </script>
</html>
