<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin</title>
    <link rel="stylesheet" href="/assets/css/quanly.css">
    <link rel="stylesheet" href="/assets/css/layout.css" />
  </head>
  <body>
    <header class="main-header">
      <div class="logo">
        <a href="quanly.html">Website quáº£n lÃ½ bÃ i viáº¿t</a>
      </div>

      <button class="theme-toggle" aria-label="Toggle light and dark mode">
        â˜€ï¸
      </button>

      <button class="menu-toggle" aria-label="Toggle navigation">
        &#9776;
      </button>

      <nav class="main-nav">
        <ul class="nav-list">
          <li><a href="noidung.html" class="nav-item">ğŸ Trang chá»§</a></li>
          <li class="admin-only" style="display: none">
            <a href="quanly.html" class="nav-item">âš™ï¸Quáº£n lÃ½ Admin</a>
          </li>
          <li class="admin-only" style="display: none">
            <a href="thongkeadmin.html" class="nav-item">ğŸ“ŠThá»‘ng kÃª Admin</a>
          </li>

          <li>
            <a href="#" class="nav-item logout-link">ğŸšªÄÄƒng xuáº¥t</a>
          </li>
          <li>
            <a
              href="login.html"
              class="nav-item login-link logout"
              style="display: none"
              >ÄÄƒng nháº­p</a
            >
          </li>
        </ul>
      </nav>
    </header>
    <p class="hello">Xin chÃ o, admin!</p>
    <div class="container">
      <div class="card left">
        <form>
          <h3>ThÃªm tÃ i khoáº£n má»›i</h3>
          <label>TÃªn Ä‘Äƒng nháº­p</label>
          <input type="text" placeholder="TÃªn Ä‘Äƒng nháº­p" autocomplete="off" />
          <label>Máº­t kháº©u</label>
          <input
            type="password"
            placeholder="Máº­t kháº©u"
            autocomplete="new-password"
          />
          <label>Vai trÃ²</label>
          <select>
            <option>Admin</option>
            <option>User</option>
          </select>
          <button class="create a">Táº¡o tÃ i khoáº£n</button>
        </form>
        <p class="ss">Táº¡o tÃ i khoáº£n thÃ nh cÃ´ng</p>
        <p class="failed">Username hoáº·c password khÃ´ng há»£p lá»‡</p>
      </div>
      <div class="card right">
        <div class="top-right">
          <h3>Danh sÃ¡ch tÃ i khoáº£n</h3>
          <input type="text" placeholder="TÃ¬m tÃ i khoáº£n...." class="search" />
        </div>
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Vai trÃ²</th>
              <th>NgÃ y táº¡o</th>
              <th>HÃ nh Ä‘á»™ng</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>admin</td>
              <td>Admin</td>
              <td>2025-01-02</td>
              <td class="active">Äang hoáº¡t Ä‘á»™ng</td>
            </tr>
            <tr>
              <td>user1</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">XÃ³a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">XÃ³a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">XÃ³a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">XÃ³a</button></td>
            </tr>
            <tr>
              <td>user2</td>
              <td>User</td>
              <td>2025-01-03</td>
              <td><button class="delete a">XÃ³a</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
  <script src="/assets/js/layout.js"></script>
  <script>
    const loggedInUser = localStorage.getItem("loggedInUser");
    const userRole = localStorage.getItem("loggedInUserRole");

    const helloElement = document.querySelector(".hello");
    const btnLogout = document.querySelector(".logout");
    const createButton = document.querySelector(".create");
    const form = document.querySelector(".card.left form");
    const usernameInput = form.querySelector("input:nth-of-type(1)");
    const passwordInput = form.querySelector("input:nth-of-type(2)");
    const roleSelect = form.querySelector("select");
    const successMessage = document.querySelector(".ss");
    const failedMessage = document.querySelector(".failed");
    const tbody = document.querySelector("table tbody");
    const searchInput = document.querySelector(".search");
    const btnStats = document.querySelector(".stats");

    // áº¨n thÃ´ng bÃ¡o máº·c Ä‘á»‹nh
    successMessage.style.display = "none";
    failedMessage.style.display = "none";

    // HÃ m láº¥y danh sÃ¡ch tÃ i khoáº£n
    const getAccounts = () => {
      return JSON.parse(localStorage.getItem("accounts")) || [];
    };

    // 1. KIá»‚M TRA QUYá»€N VÃ€ HIá»‚N THá»Š THÃ”NG TIN USER

    // Chá»‰ cho phÃ©p admin truy cáº­p trang nÃ y
    if (userRole !== "admin" || !loggedInUser) {
      alert("Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p trang quáº£n lÃ½ nÃ y.");
      window.location.href = "noidung.html";
    } else {
      helloElement.textContent = `Xin chÃ o, ${loggedInUser} (${userRole})!`;
    }

    // 2. THÃŠM TÃ€I KHOáº¢N Má»šI

    createButton.addEventListener("click", (e) => {
      e.preventDefault();
      successMessage.style.display = "none";
      failedMessage.style.display = "none";

      const user = usernameInput.value.trim();
      const pass = passwordInput.value.trim();
      const role = roleSelect.value.toLowerCase();

      if (user.length < 3 || pass.length < 6) {
        failedMessage.textContent =
          "TÃªn Ä‘Äƒng nháº­p (Ã­t nháº¥t 3 kÃ½ tá»±) hoáº·c Máº­t kháº©u (Ã­t nháº¥t 6 kÃ½ tá»±) khÃ´ng há»£p lá»‡.";
        failedMessage.style.display = "block";
        return;
      }

      let accounts = getAccounts();
      const existingAccount = accounts.find((acc) => acc.username === user);

      if (existingAccount) {
        failedMessage.textContent =
          "TÃªn Ä‘Äƒng nháº­p Ä‘Ã£ tá»“n táº¡i, vui lÃ²ng chá»n tÃªn khÃ¡c.";
        failedMessage.style.display = "block";
        return;
      }

      // ThÃªm tÃ i khoáº£n má»›i
      const newAccount = {
        username: user,
        password: pass,
        role: role,
        dateCreated: new Date().toISOString().split("T")[0],
      };

      accounts.push(newAccount);
      localStorage.setItem("accounts", JSON.stringify(accounts));

      successMessage.textContent = `Táº¡o tÃ i khoáº£n ${user} (${role}) thÃ nh cÃ´ng!`;
      successMessage.style.display = "block";

      usernameInput.value = "";
      passwordInput.value = "";
      displayAccounts(accounts);
    });

    // 3. HIá»‚N THá»Š DANH SÃCH TÃ€I KHOáº¢N

    function displayAccounts(accountsToShow) {
      tbody.innerHTML = "";

      if (accountsToShow.length === 0) {
        tbody.innerHTML =
          '<tr><td colspan="4">KhÃ´ng tÃ¬m tháº¥y tÃ i khoáº£n nÃ o.</td></tr>';
        return;
      }

      accountsToShow.forEach((account) => {
        const isCurrentUser = account.username === loggedInUser;

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${account.username}</td>
            <td>${account.role}</td>
            <td>${account.dateCreated || "N/A"}</td>
            <td>
                ${
                  isCurrentUser
                    ? `<span class="active">Äang hoáº¡t Ä‘á»™ng</span>`
                    : `<button class="delete a" data-username="${account.username}">XÃ³a</button>`
                }
            </td>
        `;
        tbody.appendChild(row);
      });

      tbody.querySelectorAll(".delete").forEach((button) => {
        button.addEventListener("click", (e) => {
          const userToDelete = e.target.dataset.username;
          handleDeleteAccount(userToDelete);
        });
      });
    }

    // 4. Xá»¬ LÃ TÃŒM KIáº¾M

    searchInput.addEventListener("input", () => {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const accounts = getAccounts();

      const filteredAccounts = accounts.filter((account) => {
        return (
          account.username.toLowerCase().includes(searchTerm) ||
          account.role.toLowerCase().includes(searchTerm)
        );
      });

      displayAccounts(filteredAccounts);
    });

    // 5. Xá»¬ LÃ XÃ“A TÃ€I KHOáº¢N

    function handleDeleteAccount(username) {
      if (username === loggedInUser) {
        alert("Báº¡n khÃ´ng thá»ƒ tá»± xÃ³a tÃ i khoáº£n cá»§a mÃ¬nh!");
        return;
      }

      if (
        !confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a tÃ i khoáº£n "${username}" khÃ´ng?`)
      ) {
        return;
      }

      let accounts = getAccounts();
      const updatedAccounts = accounts.filter(
        (acc) => acc.username !== username
      );

      localStorage.setItem("accounts", JSON.stringify(updatedAccounts));
      alert(`TÃ i khoáº£n ${username} Ä‘Ã£ Ä‘Æ°á»£c xÃ³a.`);

      displayAccounts(updatedAccounts);
    }

    // CHáº Y CHá»¨C NÄ‚NG KHI Táº¢I TRANG Láº¦N Äáº¦U
    const initialAccounts = getAccounts();
    displayAccounts(initialAccounts);
  </script>
</html>
